<div class="history-body">
  <mat-card class="history-card">
    <div fxLayout="row">
      <span class="app-spacer"></span>
      <i id="close-icon" class="app-icon fa fa-times-circle" (click)="onExitClick()"></i>
    </div>
    <mat-card-header style="justify-content: center">
      <mat-card-title style="text-align: center;">
        <h2>Anomaly history</h2>
        <h3>{{ meeting.name }}</h3>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content class="card-deck-container mat-elevation-z4">
      <ng-container
        *ngIf="anomaliesHistoryView && meetingsHistory; then historyOn; else historyOff">
      </ng-container>
      <ng-template #historyOn>
        <span>
        <mat-form-field class="first" appearance="fill">
          <mat-label>Select criteria</mat-label>
          <mat-select [(value)]="selected" (selectionChange)="onSelectChange()">
            <mat-option *ngFor="let type of filterTypes" [value]="type">
              {{ type }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="second" appearance="fill">
          <mat-label>Select meeting</mat-label>
          <mat-select [(ngModel)]="selectedMeeting" (selectionChange)="onSelectMeetingChange()">
            <mat-option value="all">
              all
            </mat-option>
            <mat-option *ngFor="let meeting of meetingsHistory" [value]="meeting.start.toISOString()">
            {{meeting.start.toLocaleString('en-GB', options)}}
            </mat-option>
          </mat-select>
        </mat-form-field>

          <mat-form-field class="second" appearance="fill">
          <mat-label>Select model</mat-label>
          <mat-select [(value)]="selectedModel" (selectionChange)="onSelectModelChange()">
            <mat-option *ngFor="let model of filterModels" [value]="model">
              {{ model }}
            </mat-option>
          </mat-select>
        </mat-form-field>


           <span class="report" fxLayoutAlign="end start">
          <i class="app-icon fa fa-2x fa-file-pdf-o" (click)="generateReport()"></i>
        </span>
          </span>

        <table mat-table [dataSource]="anomaliesHistoryView">
          <!-- Type Column -->
          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef>Type</th>
            <td mat-cell *matCellDef="let element">
              <ng-container [ngSwitch]="element.type">
                <mat-icon mat-list-icon *ngSwitchCase="'info'">info</mat-icon>
                <mat-icon mat-list-icon *ngSwitchCase="'warning'" color="warn">warning</mat-icon>
                <mat-icon id="green" mat-list-icon *ngSwitchCase="'success'">feedback</mat-icon>
                <span *ngSwitchDefault></span>
              </ng-container>
            </td>
          </ng-container>

          <!-- Start Date Column -->
          <ng-container matColumnDef="startDate">
            <th mat-header-cell *matHeaderCellDef>Start Date</th>
            <td mat-cell *matCellDef="let element"> {{element.startDate.toLocaleString('en-GB', options)}} </td>
          </ng-container>

          <!-- End Date Column -->
          <ng-container matColumnDef="endDate">
            <th mat-header-cell *matHeaderCellDef>End Date</th>
            <td mat-cell *matCellDef="let element"> {{element.endDate.toLocaleString('en-GB', options)}} </td>
          </ng-container>


          <!-- Occurrence Column -->
          <ng-container matColumnDef="occurrence">
            <th mat-header-cell *matHeaderCellDef>Occurrence</th>
            <td mat-cell *matCellDef="let element"> {{element.occurrence}} </td>
          </ng-container>

          <!-- Parameter Column -->
          <ng-container matColumnDef="parameter">
            <th mat-header-cell *matHeaderCellDef>Parameter</th>
            <td mat-cell *matCellDef="let element"> {{element.parameter}} </td>
          </ng-container>


          <!-- Condition Type Column -->
          <ng-container matColumnDef="conditionType">
            <th mat-header-cell *matHeaderCellDef>Condition Type</th>
            <td mat-cell *matCellDef="let element"> {{element.conditionType}} </td>
          </ng-container>

          <!-- Value Column -->
          <ng-container matColumnDef="reason">
            <th mat-header-cell *matHeaderCellDef>Observed Value</th>
            <td mat-cell *matCellDef="let element"> {{element.reason}} </td>
          </ng-container>

          <!-- Condition Value Column -->
          <ng-container matColumnDef="conditionValue">
            <th mat-header-cell *matHeaderCellDef>Condition Value</th>
            <td mat-cell *matCellDef="let element"> {{element.conditionValue}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
              [ngClass]="{'subanomaly': row.date === '' }"></tr>
        </table>
      </ng-template>
      <ng-template #historyOff>
        <div fxLayoutAlign="center center">
          <app-progress-bar></app-progress-bar>
        </div>
      </ng-template>

    </mat-card-content>
  </mat-card>
</div>
